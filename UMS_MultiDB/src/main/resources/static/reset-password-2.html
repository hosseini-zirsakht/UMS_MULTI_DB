<!--<!DOCTYPE html>-->
<!--<html lang="fa" dir="rtl">-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--  <title>تغییر رمز عبور</title>-->
<!--  <style>-->
<!--    /* استایل‌ها مشابه صفحه اول با تغییرات کوچک */-->
<!--    * {-->
<!--      margin: 0;-->
<!--      padding: 0;-->
<!--      box-sizing: border-box;-->
<!--      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;-->
<!--    }-->

<!--    body {-->
<!--      background: linear-gradient(135deg, #6a11cb, #2575fc);-->
<!--      color: #fff;-->
<!--      display: flex;-->
<!--      justify-content: center;-->
<!--      align-items: center;-->
<!--      min-height: 100vh;-->
<!--      padding: 20px;-->
<!--    }-->

<!--    .container {-->
<!--      background: rgba(255, 255, 255, 0.1);-->
<!--      backdrop-filter: blur(10px);-->
<!--      border-radius: 15px;-->
<!--      padding: 30px;-->
<!--      width: 100%;-->
<!--      max-width: 400px;-->
<!--      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);-->
<!--      border: 1px solid rgba(255, 255, 255, 0.18);-->
<!--    }-->

<!--    h1 {-->
<!--      text-align: center;-->
<!--      margin-bottom: 20px;-->
<!--      font-size: 24px;-->
<!--    }-->

<!--    .form-group {-->
<!--      margin-bottom: 15px;-->
<!--    }-->

<!--    label {-->
<!--      display: block;-->
<!--      margin-bottom: 8px;-->
<!--      font-weight: 500;-->
<!--    }-->

<!--    input {-->
<!--      width: 100%;-->
<!--      padding: 12px 15px;-->
<!--      border: none;-->
<!--      border-radius: 8px;-->
<!--      background: rgba(255, 255, 255, 0.2);-->
<!--      color: #fff;-->
<!--      font-size: 14px;-->
<!--      margin-bottom: 5px;-->
<!--    }-->

<!--    input::placeholder {-->
<!--      color: rgba(255, 255, 255, 0.7);-->
<!--    }-->

<!--    .error-message {-->
<!--      color: #ff6b6b;-->
<!--      font-size: 12px;-->
<!--      margin-top: 5px;-->
<!--      display: none;-->
<!--    }-->

<!--    button {-->
<!--      width: 100%;-->
<!--      padding: 12px;-->
<!--      background: #2575fc;-->
<!--      color: #fff;-->
<!--      border: none;-->
<!--      border-radius: 8px;-->
<!--      font-weight: 600;-->
<!--      margin-top: 20px;-->
<!--      cursor: pointer;-->
<!--      transition: all 0.3s;-->
<!--    }-->

<!--    button:hover {-->
<!--      background: #1a68e0;-->
<!--    }-->

<!--    .password-strength {-->
<!--      margin-top: 5px;-->
<!--      font-size: 12px;-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body>-->
<!--<div class="container">-->
<!--  <h1>تعیین رمز عبور جدید</h1>-->
<!--  <form id="passwordForm">-->
<!--    <div class="form-group">-->
<!--      <label for="newPassword">رمز عبور جدید:</label>-->
<!--      <input type="password" id="newPassword" placeholder="رمز عبور جدید را وارد کنید" required>-->
<!--      <div class="password-strength" id="passwordStrength"></div>-->
<!--    </div>-->

<!--    <div class="form-group">-->
<!--      <label for="confirmPassword">تکرار رمز عبور:</label>-->
<!--      <input type="password" id="confirmPassword" placeholder="رمز عبور را مجدداً وارد کنید" required>-->
<!--      <div class="error-message" id="passwordMatch-error"></div>-->
<!--    </div>-->

<!--    <button type="submit">تغییر رمز عبور</button>-->
<!--  </form>-->
<!--</div>-->

<!--<script>-->
<!--  // دریافت اطلاعات از localStorage-->
<!--  const resetData = JSON.parse(localStorage.getItem('resetData'));-->
<!--  if (!resetData) {-->
<!--    window.location.href = 'reset-password-1.html';-->
<!--  }-->

<!--  // بررسی قدرت رمز عبور-->
<!--  document.getElementById('newPassword').addEventListener('input', function() {-->
<!--    const password = this.value;-->
<!--    const strengthText = document.getElementById('passwordStrength');-->

<!--    if (password.length === 0) {-->
<!--      strengthText.textContent = '';-->
<!--      return;-->
<!--    }-->

<!--    if (password.length < 6) {-->
<!--      strengthText.textContent = 'ضعیف';-->
<!--      strengthText.style.color = '#ff6b6b';-->
<!--    } else if (password.length < 10) {-->
<!--      strengthText.textContent = 'متوسط';-->
<!--      strengthText.style.color = '#feca57';-->
<!--    } else {-->
<!--      strengthText.textContent = 'قوی';-->
<!--      strengthText.style.color = '#1dd1a1';-->
<!--    }-->
<!--  });-->

<!--  // ارسال فرم-->
<!--  document.getElementById('passwordForm').addEventListener('submit', async function(e) {-->
<!--    e.preventDefault();-->

<!--    const newPassword = document.getElementById('newPassword').value;-->
<!--    const confirmPassword = document.getElementById('confirmPassword').value;-->

<!--    // بررسی تطابق رمزها-->
<!--    if (newPassword !== confirmPassword) {-->
<!--      document.getElementById('passwordMatch-error').textContent = 'رمزهای عبور مطابقت ندارند';-->
<!--      document.getElementById('passwordMatch-error').style.display = 'block';-->
<!--      return;-->
<!--    }-->

<!--    try {-->
<!--      const response = await fetch('http://localhost:8080/auth/reset-password', {-->
<!--        method: 'POST',-->
<!--        headers: {-->
<!--          'Content-Type': 'application/json',-->
<!--        },-->
<!--        body: JSON.stringify({-->
<!--          nationalCode: resetData.nationalCode,-->
<!--          phoneNumber: resetData.phoneNumber,-->
<!--          newPassword: newPassword-->
<!--        })-->
<!--      });-->

<!--      const result = await response.json();-->

<!--      if (result.success) {-->
<!--        alert('رمز عبور با موفقیت تغییر یافت');-->
<!--        localStorage.removeItem('resetData');-->
<!--        window.location.href = 'login.html';-->
<!--      } else {-->
<!--        alert(result.message || 'خطا در تغییر رمز عبور');-->
<!--      }-->
<!--    } catch (error) {-->
<!--      console.error('Error:', error);-->
<!--      alert('خطا در ارتباط با سرور');-->
<!--    }-->
<!--  });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تغییر رمز عبور</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 20px;
      padding: 30px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.18);
      animation: fadeIn 0.8s ease-out;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 24px;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .form-group {
      margin-bottom: 20px;
      position: relative;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.9);
    }

    input {
      width: 100%;
      padding: 12px 15px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      background: rgba(255, 255, 255, 0.15);
      color: #fff;
      outline: none;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    input:focus {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 0 3px rgba(37, 117, 252, 0.3);
    }

    /* استایل خطاها */
    .error-message {
      color: #ff6b6b;
      font-size: 13px;
      margin-bottom: 5px;
      min-height: 18px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.3s ease-out;
    }

    .error-input {
      border: 1px solid #ff6b6b !important;
      box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2) !important;
    }

    /* پیام خطای سرور */
    .server-error {
      background: rgba(255, 107, 107, 0.2);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      border: 1px solid rgba(255, 107, 107, 0.3);
      display: none;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    button {
      width: 100%;
      padding: 14px;
      background: linear-gradient(to right, #2575fc, #6a11cb);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      margin-top: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 15px;
      box-shadow: 0 4px 15px rgba(37, 117, 252, 0.3);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(37, 117, 252, 0.4);
    }

    .password-strength {
      margin-top: 5px;
      font-size: 13px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .strength-weak {
      color: #ff6b6b;
    }

    .strength-medium {
      color: #feca57;
    }

    .strength-strong {
      color: #1dd1a1;
    }
  </style>
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/fonts.css" rel="stylesheet">
</head>
<body>
<div class="container">
  <div class="server-error" id="serverError"></div>

  <h1>تعیین رمز عبور جدید</h1>
  <form id="passwordForm">
    <div class="form-group">
      <label for="newPassword">رمز عبور جدید:</label>
      <div class="error-message" id="newPasswordError"></div>
      <input type="password" id="newPassword" name="newPassword" placeholder="رمز عبور جدید را وارد کنید">
      <div class="password-strength" id="passwordStrength"></div>
    </div>

    <div class="form-group">
      <label for="confirmPassword">تکرار رمز عبور:</label>
      <div class="error-message" id="confirmPasswordError"></div>
      <input type="password" id="confirmPassword" name="confirmPassword" placeholder="رمز عبور را مجدداً وارد کنید">
    </div>

    <button type="submit">تغییر رمز عبور</button>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // دریافت اطلاعات از localStorage
    const resetData = JSON.parse(localStorage.getItem('resetData'));
    if (!resetData) {
      window.location.href = 'reset-password-1.html';
    }

    const form = document.getElementById('passwordForm');
    const serverError = document.getElementById('serverError');

    // بررسی قدرت رمز عبور
    document.getElementById('newPassword').addEventListener('input', function() {
      const password = this.value;
      const strengthText = document.getElementById('passwordStrength');
      const errorElement = document.getElementById('newPasswordError');

      // پاک کردن خطاهای قبلی
      errorElement.textContent = '';
      this.classList.remove('error-input');

      if (password.length === 0) {
        strengthText.textContent = '';
        return;
      }

      if (password.length < 6) {
        strengthText.textContent = 'ضعیف';
        strengthText.className = 'password-strength strength-weak';
      } else if (password.length < 10) {
        strengthText.textContent = 'متوسط';
        strengthText.className = 'password-strength strength-medium';
      } else {
        strengthText.textContent = 'قوی';
        strengthText.className = 'password-strength strength-strong';
      }
    });

    // اعتبارسنجی در زمان تایپ
    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('input', function () {
        validateField(this);
      });
    });

    form.addEventListener('submit', function (event) {
      event.preventDefault();
      clearErrors();
      serverError.style.display = 'none';

      const formData = getFormData();
      const clientErrors = validateForm(formData);

      if (Object.keys(clientErrors).length > 0) {
        displayValidationErrors(clientErrors);
        return;
      }

      submitForm(formData, resetData);
    });

    function validateField(field) {
      const fieldId = field.id;
      const fieldValue = field.value.trim();
      const errorElement = document.getElementById(`${fieldId}Error`);

      // پاک کردن خطاهای قبلی
      errorElement.textContent = '';
      field.classList.remove('error-input');

      // اگر فیلد خالی است خطا نشان نده
      if (fieldValue === '') {
        return;
      }

      let error = '';

      const patterns = {

        newPassword: /^(?=.*[a-z0-9])(?=.*[A-Z])(?=.*[!@#$%&*])[a-zA-Z\d!@#$%&*]{6,}$/,
        confirmPassword: /^(?=.*[a-z0-9])(?=.*[A-Z])(?=.*[!@#$%&*])[a-zA-Z\d!@#$%&*]{6,}$/,

      };

      const messages = {

        newPassword: 'رمز عبور باید بین ۶ تا ۲۰ کاراکتر و شامل حداقل یک حرف بزرگ و کاراکتر خاص باشد',
        confirmPassword: 'رمز عبور باید بین ۶ تا ۲۰ کاراکتر و شامل حداقل یک حرف بزرگ و کاراکتر خاص باشد',

      };

      if (patterns[fieldId] && !patterns[fieldId].test(fieldValue)) {
        error = messages[fieldId];
      }

      if (error) {
        errorElement.textContent = error;
        field.classList.add('error-input');
      }
    }

    function clearErrors() {
      // پاک کردن تمام پیام‌های خطا
      document.querySelectorAll('.error-message').forEach(el => {
        el.textContent = '';
      });

      // حذف استایل خطا از تمام فیلدها
      document.querySelectorAll('.error-input').forEach(el => {
        el.classList.remove('error-input');
      });
    }

    function displayValidationErrors(errors) {
      // نمایش خطاهای اعتبارسنجی
      for (const field in errors) {
        const errorElement = document.getElementById(`${field}Error`);
        const inputElement = document.getElementById(field);

        if (errorElement && inputElement) {
          errorElement.textContent = errors[field];
          inputElement.classList.add('error-input');
        }
      }

      // اسکرول به اولین فیلد دارای خطا
      const firstError = document.querySelector('.error-input');
      if (firstError) {
        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function getFormData() {
      return {
        newPassword: document.getElementById('newPassword').value.trim(),
        confirmPassword: document.getElementById('confirmPassword').value.trim()
      };
    }

    function validateForm(formData) {
      const errors = {};

      if (!formData.newPassword) {
        errors.newPassword = 'رمز عبور جدید الزامی است';
      }

      if (!formData.confirmPassword) {
        errors.confirmPassword = 'تکرار رمز عبور الزامی است';
      }
      return errors;
    }

    function submitForm(formData, resetData) {
      fetch('http://localhost:8080/auth/reset-password', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          nationalCode: resetData.nationalCode,
          phoneNumber: resetData.phoneNumber,
          newPassword: formData.newPassword
        })
      })
              .then(async response => {
                if (!response.ok) {
                  const errorData = await response.json();
                  return Promise.reject(errorData);
                }
                return response.json();
              })
              .then(data => {
                localStorage.removeItem('resetData');
                alert('رمز عبور با موفقیت تغییر یافت');
                window.location.href = 'login.html';
              })
              .catch(error => {
                if (error.errors) {
                  // تبدیل نام فیلدها به camelCase برای تطابق با HTML
                  const formattedErrors = {};
                  for (const field in error.errors) {
                    const camelCaseField = field.replace(/([-_][a-z])/g, group =>
                            group.toUpperCase()
                                    .replace('-', '')
                                    .replace('_', ''));
                    formattedErrors[camelCaseField] = error.errors[field];
                  }
                  displayValidationErrors(formattedErrors);
                } else {
                  showServerError(error.message || 'خطا در تغییر رمز عبور');
                }
              });
    }

    function showServerError(message) {
      serverError.textContent = message;
      serverError.style.display = 'block';
      window.scrollTo({top: 0, behavior: 'smooth'});
    }
  });
</script>
</body>
</html>